<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Gauche Users' Reference</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<style type="text/css">
<!--
body {
    background-color: #253960;
    color: #ffffff;
}
body a {
    color: #88bbff;
}
body a:visited {
    color: #cc99ff;
}
#header_container {
    margin-top: 10px;
    margin-bottom: 10px;
}
#input_container {
    margin-top: 15px;
    margin-bottom: 12px;
    display: none;
}
#input_container form {
    margin: 0;
}
#result_table {
    /* table-layout: fixed; */
    width: 100%;
    margin: 0;
    padding-left: 5px;
    border: none;
    display: none;
}
#result_table td {
    word-break: break-all;
    /* word-wrap: break-word; */
    /* overflow-wrap: break-word; */
}
-->
</style>
<script type="text/javascript">
<!--
var index_line_node = [];        // 索引のノード(配列)
var next_isearch_pointer = 0;    // 次回の検索開始位置
var one_isearch_count_max = 200; // 1回あたりの検索最大数
var first_result_url = "";       // 先頭の検索結果のURL
var now_isearch_regexp = null;   // 現在の正規表現
var old_makeinfo_flag = false;   // 古い makeinfo v4.13 の対応用
var old_browser_flag = false;    // 古いブラウザ(IE8,IE9等)の対策用

// ***** 初期化 *****
window.onload = function () {
    var i;
    var node1, node2;

    // ***** 変数の初期化 *****
    index_line_node = [];
    next_isearch_pointer = 0;
    first_result_url = "";
    now_isearch_regexp = null;
    old_makeinfo_flag = false;
    old_browser_flag = false;

    // ***** 古いブラウザ(IE8,IE9等)の判定 *****
    old_browser_flag = !(typeof window.FileReader === "function");
    if (old_browser_flag) {
        // (検索機能を使用不可とする)
        return;
    }

    // ***** イベントハンドラ登録 *****
    node1 = document.getElementById("word");
    if (document.addEventListener) {
        node1.addEventListener("keydown", keydown, false);
        node1.addEventListener("keyup",   keyup,   false);
    }

    // ***** 索引のノードを取得 *****
    node1 = document.getElementById("result_table");
    if (node1.tBodies) {
        node2 = node1.getElementsByTagName('tr');
        old_makeinfo_flag = false;
    } else {
        node2 = node1.getElementsByTagName('li');
        old_makeinfo_flag = true;
    }
    for (i = 0; i < node2.length; i++) {
        index_line_node.push(node2[i]);
    }

    // ***** 表示の初期化 *****
    document.getElementById("input_container").style.display = "block";
}

// ***** キー押し下げ *****
function keydown(ev) {
    var key_code;

    // ***** キーコードの取得 *****
    key_code = ev.keyCode;
    // ***** Enterキーのときは、先頭の検索結果へジャンプ *****
    if (key_code == 13 && first_result_url != "") {
        parent.frame2.location.href = first_result_url;
    }
}

// ***** キー押し上げ *****
function keyup(ev) {
    var key_code;

    // ***** キーコードの取得 *****
    key_code = ev.keyCode;
    // ***** 矢印/PageUp/PageDown/Home/Endキーのときは抜ける *****
    if (key_code >= 33 && key_code <= 40) {
        return;
    }
    // ***** 検索遅延タイマをセット *****
    next_isearch_pointer = 0;
    setTimeout(function () { exec_isearch(next_isearch_pointer); }, 10);
}

// ***** 検索実行 *****
function exec_isearch(isearch_pointer) {
    var i;
    var word, node1, node2;
    var begin_flag = false;
    var last_flag  = false;

    // ***** 単語を取得して、正規表現オブジェクトを生成する *****
    if (isearch_pointer == 0) {
        document.getElementById("result_table").style.display = "none";
        next_isearch_pointer = 0;
        first_result_url = "";
        word = document.getElementById("word").value;
        word = word.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g, "\\$1");   // 特殊文字の無効化
        word = escape_html(word);                                      // HTML文字列のエスケープ処理
        if (word.charAt(0) == " ") { begin_flag = true; }              // 先頭空白チェック
        if (word.charAt(word.length - 1) == " ") { last_flag = true; } // 末尾空白チェック
        word = word.replace(/(^\s+)|(\s+$)/g, "");                     // 前後の空白を削除
        if (word != "") {
            if (begin_flag) { word = "^" + word; }
            if (last_flag)  { word = word + "$"; }
            now_isearch_regexp = new RegExp(word, "i");
        } else {
            // (単語が空なら抜ける)
            now_isearch_regexp = null;
            return;
        }
    }

    // ***** 検索を実行してヒットした行のみを表示する *****
    for (i = isearch_pointer; i < index_line_node.length; i++) {
        // (1回あたりの検索最大数を超えたら続きを次回にまわす)
        if (i >= isearch_pointer + one_isearch_count_max) {
            break;
        }
        node1 = index_line_node[i].getElementsByTagName("code")[0];
        if (node1 && node1.innerHTML.match(now_isearch_regexp)) {
            if (old_makeinfo_flag) {
                index_line_node[i].style.display = "block";
            } else {
                index_line_node[i].style.display = "table-row";
            }
            if (first_result_url == "") {
                node2 = index_line_node[i].getElementsByTagName('a')[0];
                if (node2) {
                    first_result_url = node2.href;
                }
            }
        } else {
            index_line_node[i].style.display = "none";
        }
    }

    // ***** 検索終了のチェック *****
    if (i < index_line_node.length) {
        // ***** 検索遅延タイマをセット *****
        next_isearch_pointer += one_isearch_count_max;
        setTimeout(function () { exec_isearch(next_isearch_pointer); }, 10);
    } else {
        if (old_makeinfo_flag) {
            document.getElementById("result_table").style.display = "block";
        } else {
            document.getElementById("result_table").style.display = "table";
        }
    }
}

// ***** HTML文字列のエスケープ処理 *****
function escape_html(html_st) {
    return html_st
        .replace(/&/g,   "&amp;")
        .replace(/[<]/g, "&lt;")
        .replace(/>/g,   "&gt;")
        .replace(/"/g,   "&quot;")
        .replace(/'/g,   "&#39;");
}

// -->
</script>
</head>

<body>
<div id="header_container">
<a target="frame2" href="#Top1000">[Top]</a>
<a target="frame2" href="#Contents1000">[Contents]</a>
<a target="frame2" href="#Index1000">[Index]</a>
</div>
<div id="input_container">
<form action="#" onsubmit="return false;">
<b>Search : </b><input type="text" id="word" value="">
</form>
</div>
<!-- index-data -->
</body>
</html>
